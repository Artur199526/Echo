<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Echo Pro ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { background: #020617; color: #f8fafc; font-family: sans-serif; }
        .echo-card { background: #0f172a; border: 1px solid #1e293b; border-radius: 20px; overflow: hidden; }
        #map { height: 250px; border-radius: 20px; margin-bottom: 20px; background: #1e293b; } /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞, –ø–æ–∫–∞ –∫–∞—Ä—Ç–∞ –≥—Ä—É–∑–∏—Ç—Å—è */
        .input-field { background: #1e293b; border: 1px solid #334155; border-radius: 12px; color: white; padding: 12px; width: 100%; outline: none; }
        #preview { width: 100%; height: 200px; object-fit: cover; display: none; border-radius: 12px; margin-bottom: 10px; }
        .boosted { border: 2px solid #fbbf24; box-shadow: 0 0 15px rgba(251, 191, 36, 0.3); }
    </style>
</head>
<body class="p-4 max-w-md mx-auto">

    <h1 class="text-3xl font-black italic text-indigo-500 mb-6 uppercase">Echo Pro</h1>

    <div id="map"></div>

    <div class="echo-card p-5 mb-8">
        <img id="preview">
        <input type="text" id="itemName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" class="input-field mb-2">
        <textarea id="itemDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ..." class="input-field mb-4 h-20"></textarea>
        
        <div class="grid grid-cols-2 gap-2 mb-4">
            <label class="bg-indigo-600 p-3 rounded-xl text-xs font-bold text-center cursor-pointer">
                üì∏ –§–û–¢–û
                <input type="file" id="fileInput" accept="image/*" class="hidden" onchange="previewImage(this)">
            </label>
            <div class="flex items-center justify-center bg-slate-800 rounded-xl">
                <input type="checkbox" id="boostCheck" class="w-4 h-4 mr-2">
                <span class="text-[10px] font-bold uppercase text-amber-400">Boost</span>
            </div>
        </div>

        <button onclick="sendSignal()" class="w-full bg-indigo-500 p-4 rounded-xl font-bold uppercase tracking-widest active:scale-95 transition">
            –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —ç—Ñ–∏—Ä
        </button>
    </div>

    <div id="feed" class="space-y-6"></div>

    <script>
        let map, currentImg = "";

        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        window.onload = function() {
            try {
                map = L.map('map').setView([55.75, 37.61], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap'
                }).addTo(map);
                
                // –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                map.locate({setView: true, maxZoom: 14});
                loadSignals();
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –∫–∞—Ä—Ç—ã:", e);
                document.getElementById('map').innerHTML = "<p class='p-4 text-red-400 text-center'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.</p>";
            }
        };

        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ
        function previewImage(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgElement = document.getElementById('preview');
                    imgElement.src = e.target.result;
                    imgElement.style.display = 'block';
                    currentImg = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        }

        function sendSignal() {
            const name = document.getElementById('itemName').value;
            const desc = document.getElementById('itemDesc').value;
            const isBoosted = document.getElementById('boostCheck').checked;

            if (!name || !currentImg) {
alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ!");
                return;
            }

            // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å—Ç–∞–≤–∏–º —Ü–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã
            navigator.geolocation.getCurrentPosition((pos) => {
                saveSignal(pos.coords.latitude, pos.coords.longitude, name, desc, isBoosted);
            }, () => {
                const center = map.getCenter();
                saveSignal(center.lat, center.lng, name, desc, isBoosted);
            });
        }

        function saveSignal(lat, lng, name, desc, isBoosted) {
            const signal = { lat, lng, name, desc, isBoosted, img: currentImg, id: Date.now() };
            const saved = JSON.parse(localStorage.getItem('echo_v4')) || [];
            saved.unshift(signal);
            localStorage.setItem('echo_v4', JSON.stringify(saved));
            location.reload(); 
        }

        function loadSignals() {
            const feed = document.getElementById('feed');
            const saved = JSON.parse(localStorage.getItem('echo_v4')) || [];
            
            saved.forEach(s => {
                // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –Ω–∞ –∫–∞—Ä—Ç—É
                L.marker([s.lat, s.lng]).addTo(map).bindPopup(s.name);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –≤ –ª–µ–Ω—Ç—É
                const card = document.createElement('div');
                card.className = echo-card ${s.isBoosted ? 'boosted' : ''};
                card.innerHTML = `
                    <img src="${s.img}" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <h3 class="font-bold text-lg ${s.isBoosted ? 'text-amber-400' : ''}">${s.isBoosted ? '‚≠ê ' : ''}${s.name}</h3>
                        <p class="text-sm text-slate-400 mt-1">${s.desc}</p>
                    </div>
                `;
                feed.appendChild(card);
            });
        }
    </script>
</body>
</html>
